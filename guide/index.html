<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Guide | ctrl-flow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lbl-srg.github.io/modelica-buildings-templates/guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Guide | ctrl-flow"><meta data-rh="true" name="description" content="This document provides some requirements and recommendations for the development of HVAC system templates to be included in the Modelica Buildings Library (MBL)."><meta data-rh="true" property="og:description" content="This document provides some requirements and recommendations for the development of HVAC system templates to be included in the Modelica Buildings Library (MBL)."><link data-rh="true" rel="icon" href="/modelica-buildings-templates/img/favicon.png"><link data-rh="true" rel="canonical" href="https://lbl-srg.github.io/modelica-buildings-templates/guide"><link data-rh="true" rel="alternate" href="https://lbl-srg.github.io/modelica-buildings-templates/guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://lbl-srg.github.io/modelica-buildings-templates/guide" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/modelica-buildings-templates/assets/css/styles.544deef4.css">
<link rel="preload" href="/modelica-buildings-templates/assets/js/runtime~main.f6823879.js" as="script">
<link rel="preload" href="/modelica-buildings-templates/assets/js/main.85178fec.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/modelica-buildings-templates/"><div class="navbar__logo"><img src="/modelica-buildings-templates/img/favicon.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/modelica-buildings-templates/img/favicon.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ctrl-flow</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/modelica-buildings-templates/guide">Guide</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/modelica-buildings-templates/guide">Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/modelica-buildings-templates/category/more">More</a><button aria-label="Toggle the collapsible sidebar category &#x27;More&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/modelica-buildings-templates/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Guide</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Guide</h1><p>This document provides some requirements and recommendations for the development of HVAC system templates to be included in the <a href="https://github.com/lbl-srg/modelica-buildings" target="_blank" rel="noopener noreferrer">Modelica Buildings Library</a> (MBL).
It is primarily intended for developers and therefore contains some detailed implementation guidelines.
For a more conceptual presentation of MBL templates, see <a href="/modelica-buildings-templates/more/references#Gautier23">Gautier (2023)</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interface-class">Interface Class: What Shall Be Declared?<a href="#interface-class" class="hash-link" aria-label="Direct link to Interface Class: What Shall Be Declared?" title="Direct link to Interface Class: What Shall Be Declared?">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="outside-connectors-needed-by-any-derived-class">Outside Connectors Needed by Any Derived Class<a href="#outside-connectors-needed-by-any-derived-class" class="hash-link" aria-label="Direct link to Outside Connectors Needed by Any Derived Class" title="Direct link to Outside Connectors Needed by Any Derived Class">​</a></h3><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Important</div><div class="admonitionContent_S0QG"><p>All <a href="https://specification.modelica.org/maint/3.5/connectors-and-connections.html#inside-and-outside-connectors" target="_blank" rel="noopener noreferrer">outside connectors</a> must be declared within the interface class<!-- -->—<!-- -->with the suitable conditional instance statements.</p><p>(Each class extending an interface class shall not declare any outside connector<!-- -->—<!-- -->it may only conditionally remove inherited connectors.)</p></div></div><p>This ensures the <a href="https://specification.modelica.org/maint/3.5/interface-or-type-relationships.html#plug-compatibility-or-restricted-subtyping" target="_blank" rel="noopener noreferrer">plug-compatibility</a> of each derived class, and implies a fixed connectivity structure for each instantiated subsystem model, allowing these instances to be connected to each other without worrying about the actual configuration of each subsystem.
This applies to connecting components within a template, or connecting templates to each other to create a whole-building model.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p><em>How does it comply with the <a href="https://specification.modelica.org/maint/3.5/scoping-name-lookup-and-flattening.html#generation-of-the-flat-equation-system" target="_blank" rel="noopener noreferrer">Modelica Language Specification</a>?</em></p><p>Type compatibility:</p><blockquote><p>Each reference is checked, whether it is a valid reference, e.g. the referenced object belongs to or is an instance, where all <em>existing conditional declaration expressions evaluate to true|false</em>, or it is a constant in a package.</p></blockquote><p>So checking that the redeclared component is a subtype of the constraining class is done with all the conditional connectors considered present (even if the redeclared component removes them).</p><p><em>How does it differ from interface classes in the Modelica Buildings Library?</em></p><p>Interface classes are usually implemented with the minimum set of connectors (and other variables) and derived classes extend that set, which ensures <em>type</em> compatibility.
See for example:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Fluid/Boilers/BaseClasses/PartialBoiler.mo"><div class="code-title">Fluid/Boilers/BaseClasses/PartialBoiler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#267F99">extends</span><span style="color:#0000FF"> Interfaces.TwoPortHeatMassExchanger</span><span style="color:#000000">(...); </span><span style="color:#008000">// Interface class used by the model</span></div><div class="line"></div><div class="line"><span style="color:#0000FF">Modelica.Blocks.Interfaces.RealInput</span><span style="color:#000000"> y(...)       </span><span style="color:#008000">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Part load ratio&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">Modelica.Blocks.Interfaces.RealOutput</span><span style="color:#000000"> T(...)      </span><span style="color:#008000">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Temperature of the fluid&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</span><span style="color:#000000"> heatPort  </span><span style="color:#008000">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Heat port, can be used to connect to ambient&quot;</span><span style="color:#000000">;</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Fluid/Boilers/BaseClasses/PartialBoiler.mo"><div class="code-title">Fluid/Boilers/BaseClasses/PartialBoiler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#4EC9B0">extends</span><span style="color:#569CD6"> Interfaces.TwoPortHeatMassExchanger</span><span style="color:#D4D4D4">(...); </span><span style="color:#6A9955">// Interface class used by the model</span></div><div class="line"></div><div class="line"><span style="color:#569CD6">Modelica.Blocks.Interfaces.RealInput</span><span style="color:#D4D4D4"> y(...)       </span><span style="color:#6A9955">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Part load ratio&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">Modelica.Blocks.Interfaces.RealOutput</span><span style="color:#D4D4D4"> T(...)      </span><span style="color:#6A9955">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Temperature of the fluid&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</span><span style="color:#D4D4D4"> heatPort  </span><span style="color:#6A9955">// Additional connector not declared in the interface class</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Heat port, can be used to connect to ambient&quot;</span><span style="color:#D4D4D4">;</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="both-the-parameter-record-and-locally-accessible-design-parameters">Both the <a href="#parameter-record">Parameter Record</a> and Locally Accessible Design Parameters<a href="#both-the-parameter-record-and-locally-accessible-design-parameters" class="hash-link" aria-label="Direct link to both-the-parameter-record-and-locally-accessible-design-parameters" title="Direct link to both-the-parameter-record-and-locally-accessible-design-parameters">​</a></h3><p>The parameter record is for propagation of design and operating parameters across the instance tree.</p><p>The local design parameter declarations ensure that a standard set of parameters is available in any template or component, for any configuration.
(For example, an evaporator coil still has <code>mChiWat_flow_nominal</code> defined with a final assignment to <code>0</code>.)
This way, one can easily compute the sum of a quantity over a set of instances.
(For example, the total CHW flow rate over all terminal units.)</p><p>Most of the local design parameters have <code>final</code> assignments to the parameters from the record.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Example</summary><div><div class="collapsibleContent_i85q"><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">final</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#000000"> mAirSup_flow_nominal=</span></div><div class="line"><span style="color:#000000">  dat.mAirSup_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Supply air mass flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#0000FF">final</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#000000"> mAirRet_flow_nominal=</span></div><div class="line"><span style="color:#000000">  dat.mAirRet_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Return air mass flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#000000"> mChiWat_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Total CHW mass flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#000000"> mHeaWat_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Total HHW mass flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter Modelica.Units.SI.HeatFlowRate</span><span style="color:#000000"> QChiWat_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Total CHW heat flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter Modelica.Units.SI.HeatFlowRate</span><span style="color:#000000"> QHeaWat_flow_nominal</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Total HHW heat flow rate&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#D4D4D4"> mAirSup_flow_nominal=</span></div><div class="line"><span style="color:#D4D4D4">  dat.mAirSup_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Supply air mass flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#D4D4D4"> mAirRet_flow_nominal=</span></div><div class="line"><span style="color:#D4D4D4">  dat.mAirRet_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Return air mass flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#D4D4D4"> mChiWat_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Total CHW mass flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter Modelica.Units.SI.MassFlowRate</span><span style="color:#D4D4D4"> mHeaWat_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Total HHW mass flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter Modelica.Units.SI.HeatFlowRate</span><span style="color:#D4D4D4"> QChiWat_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Total CHW heat flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter Modelica.Units.SI.HeatFlowRate</span><span style="color:#D4D4D4"> QHeaWat_flow_nominal</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Total HHW heat flow rate&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(group=&quot;Nominal condition&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>And the derived class:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#267F99">extends</span><span style="color:#0000FF"> Buildings.Templates.AirHandlersFans.Interfaces.PartialAirHandler</span><span style="color:#000000">(</span></div><div class="line"><span style="color:#000000">  ...</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> mChiWat_flow_nominal=</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiCoo.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiCoo.mWat_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> mHeaWat_flow_nominal=(</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiHeaPre.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiHeaPre.mWat_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">) +</span></div><div class="line"><span style="color:#000000">    (</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiHeaReh.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiHeaReh.mWat_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">),</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> QChiWat_flow_nominal=</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiCoo.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiCoo.Q_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> QHeaWat_flow_nominal=(</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiHeaPre.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiHeaPre.Q_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">) +</span></div><div class="line"><span style="color:#000000">    (</span><span style="color:#AF00DB">if</span><span style="color:#0000FF"> coiHeaReh.have_sou</span><span style="color:#000000"> </span><span style="color:#AF00DB">then</span><span style="color:#0000FF"> dat.coiHeaReh.Q_flow_nominal</span><span style="color:#000000"> </span><span style="color:#AF00DB">else</span><span style="color:#000000"> </span><span style="color:#098658">0</span><span style="color:#000000">));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#4EC9B0">extends</span><span style="color:#569CD6"> Buildings.Templates.AirHandlersFans.Interfaces.PartialAirHandler</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#D4D4D4">  ...</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> mChiWat_flow_nominal=</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiCoo.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiCoo.mWat_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> mHeaWat_flow_nominal=(</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiHeaPre.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiHeaPre.mWat_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">) +</span></div><div class="line"><span style="color:#D4D4D4">    (</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiHeaReh.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiHeaReh.mWat_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">),</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> QChiWat_flow_nominal=</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiCoo.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiCoo.Q_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> QHeaWat_flow_nominal=(</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiHeaPre.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiHeaPre.Q_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">) +</span></div><div class="line"><span style="color:#D4D4D4">    (</span><span style="color:#C586C0">if</span><span style="color:#569CD6"> coiHeaReh.have_sou</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">then</span><span style="color:#569CD6"> dat.coiHeaReh.Q_flow_nominal</span><span style="color:#D4D4D4"> </span><span style="color:#C586C0">else</span><span style="color:#D4D4D4"> </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-record">Both the <a href="#subrecord-with-configuration-parameters">Configuration Record</a> and Locally Accessible Configuration Parameters<a href="#configuration-record" class="hash-link" aria-label="Direct link to configuration-record" title="Direct link to configuration-record">​</a></h3><p>The configuration parameters are declared in the interface class, as is the configuration record <code>cfg</code> which &quot;groups&quot; them into a single object more suitable for propagation.</p><p>This record instance is not needed directly within a template class, but rather serves to reduce the number of parameter bindings when using a top-level parameter record (for all HVAC systems) that must access the configuration parameters of each template instance.
It can be considered as the &quot;signature&quot; for a given system configuration, accessible within any template.</p><p>The instance <code>cfg</code> must be ultimately assigned the <code>final</code> keyword, as it should not be exposed to the user.
Contrary to design and operating parameters, the configuration parameters are propagated (with <code>final</code> bindings) <em>from</em> the component model <em>to</em> the record instance.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Example</summary><div><div class="collapsibleContent_i85q"><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">replaceable</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">Buildings.Templates.AirHandlersFans.Configuration.PartialAirHandler</span><span style="color:#000000"> cfg(</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> typ=typ,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> typFanSup=typFanSup,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> typFanRel=typFanRel,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> typFanRet=typFanRet,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> have_souChiWat=have_souChiWat,</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> have_souHeaWat=have_souHeaWat)</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Configuration parameters&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">parameter Buildings.Templates.AirHandlersFans.Types.Configuration</span><span style="color:#000000"> typ</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Type of system&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">Boolean</span><span style="color:#000000"> have_porRel=</span></div><div class="line"><span style="color:#000000">  typ==Buildings.Templates.AirHandlersFans.Types.Configuration.ExhaustOnly</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Set to true for relief (exhaust) fluid port&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;, enable=false));</span></div><div class="line"><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">Boolean</span><span style="color:#000000"> have_souChiWat</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Set to true if system uses CHW&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">Boolean</span><span style="color:#000000"> have_souHeaWat</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Set to true if system uses HHW&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#0000FF">inner</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#000000"> typFanSup</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Type of supply fan&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#0000FF">inner</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#000000"> typFanRet</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Type of return fan&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#0000FF">inner</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#000000"> typFanRel</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Type of relief fan&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Interfaces/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">replaceable</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">Buildings.Templates.AirHandlersFans.Configuration.PartialAirHandler</span><span style="color:#D4D4D4"> cfg(</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typ=typ,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typFanSup=typFanSup,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typFanRel=typFanRel,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typFanRet=typFanRet,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> have_souChiWat=have_souChiWat,</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> have_souHeaWat=have_souHeaWat)</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Configuration parameters&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">parameter Buildings.Templates.AirHandlersFans.Types.Configuration</span><span style="color:#D4D4D4"> typ</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Type of system&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">Boolean</span><span style="color:#D4D4D4"> have_porRel=</span></div><div class="line"><span style="color:#D4D4D4">  typ==Buildings.Templates.AirHandlersFans.Types.Configuration.ExhaustOnly</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Set to true for relief (exhaust) fluid port&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;, enable=false));</span></div><div class="line"><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">Boolean</span><span style="color:#D4D4D4"> have_souChiWat</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Set to true if system uses CHW&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">Boolean</span><span style="color:#D4D4D4"> have_souHeaWat</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Set to true if system uses HHW&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#569CD6">inner</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#D4D4D4"> typFanSup</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Type of supply fan&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#569CD6">inner</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#D4D4D4"> typFanRet</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Type of return fan&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div><div class="line"><span style="color:#569CD6">inner</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter Buildings.Templates.Components.Types.Fan</span><span style="color:#D4D4D4"> typFanRel</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Type of relief fan&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Evaluate=true, Dialog(group=&quot;Configuration&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>And the derived class:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#267F99">extends</span><span style="color:#0000FF"> Buildings.Templates.AirHandlersFans.Interfaces.PartialAirHandler</span><span style="color:#000000">(</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">redeclare</span><span style="color:#000000"> </span><span style="color:#0000FF">final Buildings.Templates.AirHandlersFans.Configuration.VAVMultiZone</span><span style="color:#000000"> cfg(</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typCoiHeaPre=</span><span style="color:#0000FF">coiHeaPre.typ</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typCoiCoo=</span><span style="color:#0000FF">coiCoo.typ</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typCoiHeaReh=</span><span style="color:#0000FF">coiHeaReh.typ</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typValCoiHeaPre=</span><span style="color:#0000FF">coiHeaPre.typVal</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typValCoiCoo=</span><span style="color:#0000FF">coiCoo.typVal</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typValCoiHeaReh=</span><span style="color:#0000FF">coiHeaReh.typVal</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typDamOut=</span><span style="color:#0000FF">secOutRel.typDamOut</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typDamOutMin=</span><span style="color:#0000FF">secOutRel.typDamOutMin</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typDamRet=</span><span style="color:#0000FF">secOutRel.typDamRet</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typDamRel=</span><span style="color:#0000FF">secOutRel.typDamRel</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typSecOut=</span><span style="color:#0000FF">secOutRel.typSecOut</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> typCtl=</span><span style="color:#0000FF">ctl.typ</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> buiPreCon=</span><span style="color:#0000FF">ctl.buiPreCon</span><span style="color:#000000">,</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#0000FF">final</span><span style="color:#000000"> stdVen=ctl.stdVen), ...);</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#4EC9B0">extends</span><span style="color:#569CD6"> Buildings.Templates.AirHandlersFans.Interfaces.PartialAirHandler</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">redeclare</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">final Buildings.Templates.AirHandlersFans.Configuration.VAVMultiZone</span><span style="color:#D4D4D4"> cfg(</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typCoiHeaPre=</span><span style="color:#569CD6">coiHeaPre.typ</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typCoiCoo=</span><span style="color:#569CD6">coiCoo.typ</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typCoiHeaReh=</span><span style="color:#569CD6">coiHeaReh.typ</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typValCoiHeaPre=</span><span style="color:#569CD6">coiHeaPre.typVal</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typValCoiCoo=</span><span style="color:#569CD6">coiCoo.typVal</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typValCoiHeaReh=</span><span style="color:#569CD6">coiHeaReh.typVal</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typDamOut=</span><span style="color:#569CD6">secOutRel.typDamOut</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typDamOutMin=</span><span style="color:#569CD6">secOutRel.typDamOutMin</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typDamRet=</span><span style="color:#569CD6">secOutRel.typDamRet</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typDamRel=</span><span style="color:#569CD6">secOutRel.typDamRel</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typSecOut=</span><span style="color:#569CD6">secOutRel.typSecOut</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> typCtl=</span><span style="color:#569CD6">ctl.typ</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> buiPreCon=</span><span style="color:#569CD6">ctl.buiPreCon</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> stdVen=ctl.stdVen), ...);</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>This allows the top-level parameter record to access all configuration parameters of a VAV instance with a single binding as follows.</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Validation/UserProject/Data/AllSystems.mo"><div class="code-title">Templates/AirHandlersFans/Validation/UserProject/Data/AllSystems.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">outer</span><span style="color:#000000"> VAV VAV_1</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Instance of MZVAV model&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">parameter Buildings.Templates.AirHandlersFans.Data.VAVMultiZone</span><span style="color:#000000"> dat_VAV_1(</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">final</span><span style="color:#000000"> cfg=</span><span style="color:#0000FF">VAV_1.cfg</span><span style="color:#000000">, ...);</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Validation/UserProject/Data/AllSystems.mo"><div class="code-title">Templates/AirHandlersFans/Validation/UserProject/Data/AllSystems.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">outer</span><span style="color:#D4D4D4"> VAV VAV_1</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Instance of MZVAV model&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">parameter Buildings.Templates.AirHandlersFans.Data.VAVMultiZone</span><span style="color:#D4D4D4"> dat_VAV_1(</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">final</span><span style="color:#D4D4D4"> cfg=</span><span style="color:#569CD6">VAV_1.cfg</span><span style="color:#D4D4D4">, ...);</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nested-expandable-connectors">Nested Expandable Connectors<a href="#nested-expandable-connectors" class="hash-link" aria-label="Direct link to Nested Expandable Connectors" title="Direct link to Nested Expandable Connectors">​</a></h3><p>The interface class of the <a href="#main-controller">main controller</a> must have protected instances of all sub-buses, and these sub-bus instances must be connected to the corresponding variables from the main control bus as follows:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/ChilledWaterPlants/Components/Interfaces/PartialController.mo"><div class="code-title">Templates/ChilledWaterPlants/Components/Interfaces/PartialController.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">Buildings.Templates.ChilledWaterPlants.Interfaces.Bus</span><span style="color:#000000"> bus</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#A31515">&quot;Plant control bus&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">protected</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">Buildings.Templates.Components.Interfaces.Bus</span><span style="color:#000000"> busValChiWatChiIso[nChi]</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#AF00DB">if</span><span style="color:#000000"> typValChiWatChiIso&lt;&gt;Buildings.Templates.Components.Types.Valve.None</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#A31515">&quot;Chiller CHW isolation valve control bus&quot;</span><span style="color:#000000">;</span></div><div class="line"><span style="color:#0000FF">equation</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(busValChiWatChiIso, bus.valChiWatChiIso)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/ChilledWaterPlants/Components/Interfaces/PartialController.mo"><div class="code-title">Templates/ChilledWaterPlants/Components/Interfaces/PartialController.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">Buildings.Templates.ChilledWaterPlants.Interfaces.Bus</span><span style="color:#D4D4D4"> bus</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#CE9178">&quot;Plant control bus&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">protected</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">Buildings.Templates.Components.Interfaces.Bus</span><span style="color:#D4D4D4"> busValChiWatChiIso[nChi]</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#C586C0">if</span><span style="color:#D4D4D4"> typValChiWatChiIso&lt;&gt;Buildings.Templates.Components.Types.Valve.None</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#CE9178">&quot;Chiller CHW isolation valve control bus&quot;</span><span style="color:#D4D4D4">;</span></div><div class="line"><span style="color:#569CD6">equation</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(busValChiWatChiIso, bus.valChiWatChiIso)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>This is particularly important in the case of array sub-buses. We avoid pre-declaring these sub-buses in the main bus definition because this would require including structural parameters for the array size inside the bus, and thus binding these parameters for each bus instance. Instead, we use instances of sub-buses <em>in the interface class of the controller</em> and the connect statement <code>connect(bus&lt;Component&gt;, bus.&lt;component&gt;)</code> allows Modelica compilers to assign the correct dimensions to <code>bus.&lt;component&gt;</code> (which is not predeclared in the bus definition).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replaceable-component">Replaceable Component<a href="#replaceable-component" class="hash-link" aria-label="Direct link to Replaceable Component" title="Direct link to Replaceable Component">​</a></h3><p>No <code>choicesAllMatching</code> annotation is allowed in the <code>Templates</code> package (to maximize support across various Modelica tools).
Expand into an explicit <code>choices</code> annotation with proper description strings and the following rules.</p><p>Systematically use <code>redeclare replaceable</code> in the <code>choices</code> annotation to allow</p><ul><li>further redeclaration by the user,</li><li>visiting the parameter dialog box of the redeclared component (this is Dymola&#x27;s behavior, although this behavior is automatically enabled if the redeclared component contains replaceable components).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-replaceable-component">Non-replaceable Component<a href="#non-replaceable-component" class="hash-link" aria-label="Direct link to Non-replaceable Component" title="Direct link to Non-replaceable Component">​</a></h3><p>If a composite component (such as a <a href="#section">section</a>) contains replaceable components, or components with configuration parameters that must be exposed, then it must be instantiated with the <code>replaceable</code> keyword so that ctrl-flow generates a parameter dialog for this component, and allows the user to specify the options for the nested components.</p><p>This is true even if the type of the composite component is fixed.
In this case, the component is still declared as <code>replaceable</code>, but without any <code>choices</code> annotation (e.g., section <code>secOutRel</code> in <code>Templates/AirHandlersFans/VAVMultiZone.mo</code>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="section">Section<a href="#section" class="hash-link" aria-label="Direct link to Section" title="Direct link to Section">​</a></h3><p>A composite model that we call <em>section</em> is needed whenever there is a hard constraint on the allowed choices for two replaceable components that are on the same composition level.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Example</summary><div><div class="collapsibleContent_i85q"><p>In the case of a multiple-zone VAV with an air economizer, a return fan should require a modulating relief damper. However, we cannot bind the redeclaration of the damper component to the redeclaration of the return fan component. So we introduce a section <code>Templates.AirHandlersFans.Components.ReliefReturnSection</code> that contains the two components, so that the whole section component can be redeclared with the proper inside fan and damper components.</p></div></div></details><p>The interface class for a section must use the same class for the control bus as the one used by the system template.
This is different from the base components, which have their own class for the control bus, as is implemented in <code>Templates.Components.Interfaces.Bus</code>.
The motivation is to avoid nesting expandable connectors and to allow seamless traversal of the composition levels when connecting signal variables, see for example:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">secOutRel.bus</span><span style="color:#000000">, bus);            </span><span style="color:#008000">// secOutRel is a section (instance of OutdoorReliefReturnSection)</span></div><div class="line"><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">ctl.bus</span><span style="color:#000000">, bus);                  </span><span style="color:#008000">// ctl is a controller (instance of G36VAVMultiZone)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">secOutRel.bus</span><span style="color:#D4D4D4">, bus);            </span><span style="color:#6A9955">// secOutRel is a section (instance of OutdoorReliefReturnSection)</span></div><div class="line"><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">ctl.bus</span><span style="color:#D4D4D4">, bus);                  </span><span style="color:#6A9955">// ctl is a controller (instance of G36VAVMultiZone)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Components/OutdoorReliefReturnSection.mo"><div class="code-title">Templates/AirHandlersFans/Components/OutdoorReliefReturnSection.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">damRet.bus</span><span style="color:#000000">, bus.damRet);        </span><span style="color:#008000">// connection to the damper bus inside the section</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Components/OutdoorReliefReturnSection.mo"><div class="code-title">Templates/AirHandlersFans/Components/OutdoorReliefReturnSection.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">damRet.bus</span><span style="color:#D4D4D4">, bus.damRet);        </span><span style="color:#6A9955">// connection to the damper bus inside the section</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Components/Controls/G36VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/Components/Controls/G36VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">ctl.yRetDamPos</span><span style="color:#000000">, bus.damRet.y);  </span><span style="color:#008000">// accessing the damper control variable inside the controller</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Components/Controls/G36VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/Components/Controls/G36VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">ctl.yRetDamPos</span><span style="color:#D4D4D4">, bus.damRet.y);  </span><span style="color:#6A9955">// accessing the damper control variable inside the controller</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-controller">Main Controller<a href="#main-controller" class="hash-link" aria-label="Direct link to Main Controller" title="Direct link to Main Controller">​</a></h2><p>The template is intended to be used by applications other than Modelica tools, such as <a href="https://ctrl-flow.lbl.gov/" target="_blank" rel="noopener noreferrer">ctrl-flow</a>. To be compatible with these applications, the controller implementation must respect the following rules.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="control-section">Control Section<a href="#control-section" class="hash-link" aria-label="Direct link to Control Section" title="Direct link to Control Section">​</a></h3><p>All blocks that constitute the control sequence of a system are instantiated within a single component within the template.
This component is referred to as the &quot;control section&quot; and is named <code>ctl</code>. It is similar to a <a href="#section">section</a>, see for example <a href="https://github.com/lbl-srg/modelica-buildings/blob/90c974a19eac3333c1da139961c5c504797b9259/Buildings/Templates/AirHandlersFans/Components/Controls/G36VAVMultiZone.mo" target="_blank" rel="noopener noreferrer"><code>Templates.AirHandlersFans.Components.Controls.G36VAVMultiZone</code></a>.</p><p>The component <code>ctl</code> is <em>not</em> CDL-compliant due to the following reasons:</p><ul><li>It contains extends and redeclare statements.</li><li>It may include inner and outer declarations.<ul><li>This remains true for the VAV templates, which were the first to be developed. However, the most recently developed templates have deprecated the use of inner and outer declarations, with the exception of the requirement stated below.</li><li>Beyond the control section, to reference the configuration parameters from each configuration class prior to class instantiation, it is also necessary to include outer declarations within the top-level data record that stores the control parameter values.</li></ul></li><li>It uses expandable connectors.</li><li>It may have an initial equation section.</li><li>It employs non-permissible data types, such as <code>Modelica.Units.SI.**</code>.</li><li>It assigns values to parameters using variables from the equipment model, which are outside the CDL scope.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="control-parameters-and-binding-equations">Control Parameters and Binding Equations<a href="#control-parameters-and-binding-equations" class="hash-link" aria-label="Direct link to Control Parameters and Binding Equations" title="Direct link to Control Parameters and Binding Equations">​</a></h3><p>In contrast to the CDL implementation of the SOO, we restrict the exposed parameters to the data that are</p><ul><li>scheduled in design documents by the design engineer, or</li><li>provided by the testing, adjusting, and balancing contractor, or</li><li>determined by the control contractor.</li></ul><p>See <a href="/modelica-buildings-templates/more/references#Ashrae21">ASHRAE (2021)</a> Section<!-- --> <!-- -->3 for typical required data.</p><p>These parameters are propagated by means of the <a href="#parameter-record">parameter record</a>.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Important</div><div class="admonitionContent_S0QG"><p>Control parameters within the control section shall be assigned a value using only binding equations that involve expressions permitted in CDL: see <a href="https://obc.lbl.gov/specification/cdl.html#parameter-declaration-and-assigning-of-values-to-parameters" target="_blank" rel="noopener noreferrer">https://obc.lbl.gov/specification/cdl.html#parameter-declaration-and-assigning-of-values-to-parameters</a>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="control-point-connections">Control Point Connections<a href="#control-point-connections" class="hash-link" aria-label="Direct link to Control Point Connections" title="Direct link to Control Point Connections">​</a></h3><p>All connect clauses between the control blocks within <code>ctl</code> have a graphical annotation (so there are visible connection lines representing those connections).</p><p>Most of the other connect clauses have no graphical annotation — typically the connection to a sensor or actuator signal — as this would overload the diagram view.
Instead, a dedicated section is used at the top of the <code>equation</code> section.</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">equation</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">/* Control point connection - start */</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">// Inputs from AHU bus</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">bus.pAirSup_rel</span><span style="color:#000000">, ctl.dpDuc);</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">bus.TOut</span><span style="color:#000000">, ctl.TOut);</span></div><div class="line"><span style="color:#000000">  ...</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">// Inputs from terminal bus</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">busTer.yReqZonPreRes</span><span style="color:#000000">, reqZonPreRes.u);</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">busTer.yReqZonTemRes</span><span style="color:#000000">, reqZonTemRes.u);</span></div><div class="line"><span style="color:#000000">  ...</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">// Outputs to AHU bus</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">ctl.yMinOutDam</span><span style="color:#000000">, bus.damOutMin.y);</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">ctl.y1MinOutDam</span><span style="color:#000000">, bus.damOutMin.y1);</span></div><div class="line"><span style="color:#000000">  ...</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">// Outputs to terminal unit bus</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">TAirSupSet.y</span><span style="color:#000000">, busTer.TAirSupSet);</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">TAirSup.y</span><span style="color:#000000">, busTer.TAirSup);</span></div><div class="line"><span style="color:#000000">  ...</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">/* Control point connection - stop */</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/VAVMultiZone.mo"><div class="code-title">Templates/AirHandlersFans/VAVMultiZone.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">equation</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">/* Control point connection - start */</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">// Inputs from AHU bus</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">bus.pAirSup_rel</span><span style="color:#D4D4D4">, ctl.dpDuc);</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">bus.TOut</span><span style="color:#D4D4D4">, ctl.TOut);</span></div><div class="line"><span style="color:#D4D4D4">  ...</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">// Inputs from terminal bus</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">busTer.yReqZonPreRes</span><span style="color:#D4D4D4">, reqZonPreRes.u);</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">busTer.yReqZonTemRes</span><span style="color:#D4D4D4">, reqZonTemRes.u);</span></div><div class="line"><span style="color:#D4D4D4">  ...</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">// Outputs to AHU bus</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">ctl.yMinOutDam</span><span style="color:#D4D4D4">, bus.damOutMin.y);</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">ctl.y1MinOutDam</span><span style="color:#D4D4D4">, bus.damOutMin.y1);</span></div><div class="line"><span style="color:#D4D4D4">  ...</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">// Outputs to terminal unit bus</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">TAirSupSet.y</span><span style="color:#D4D4D4">, busTer.TAirSupSet);</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">TAirSup.y</span><span style="color:#D4D4D4">, busTer.TAirSup);</span></div><div class="line"><span style="color:#D4D4D4">  ...</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">/* Control point connection - stop */</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>Note that the control section uses the same class for the control bus as the one used by the system template.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Use the same name for the signal variable and for the component it originates from.</p></div></div><p>Inside the control section, connections to variables within nested expandable connectors should be done by means of the <a href="#nested-expandable-connectors">local instances of sub-buses</a> to guarantee that Modelica compilers assign correct dimensions to these variables.
See the example in <a href="/modelica-buildings-templates/more/references#Gautier23">Gautier (2023)</a> Section<!-- --> <!-- -->5. See also:</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/ChilledWaterPlants/Components/Controls/G36.mo"><div class="code-title">Templates/ChilledWaterPlants/Components/Controls/G36.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">equation</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">/* Control point connection - start */</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#795E26">connect</span><span style="color:#000000">(</span><span style="color:#0000FF">busChi.y1ChiWatReq</span><span style="color:#000000">, ctl.uChiWatReq);  </span><span style="color:#008000">// as opposed to connect(bus.chi.y1ChiWatReq, ctl.uChiWatReq)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/ChilledWaterPlants/Components/Controls/G36.mo"><div class="code-title">Templates/ChilledWaterPlants/Components/Controls/G36.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">equation</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">/* Control point connection - start */</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#DCDCAA">connect</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">busChi.y1ChiWatReq</span><span style="color:#D4D4D4">, ctl.uChiWatReq);  </span><span style="color:#6A9955">// as opposed to connect(bus.chi.y1ChiWatReq, ctl.uChiWatReq)</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><h3 class="anchor anchorWithStickyNavbar_LWe7" id="equipment-status">Equipment Status<a href="#equipment-status" class="hash-link" aria-label="Direct link to Equipment Status" title="Direct link to Equipment Status">​</a></h3><p>An ad hoc <a href="https://github.com/lbl-srg/modelica-buildings/blob/05e02f395bbfae2ad0430936620b09e7823cae63/Buildings/Templates/Components/Controls/StatusEmulator.mo" target="_blank" rel="noopener noreferrer">component</a> has been developed to emulate the equipment status and should be used systematically.</p><p>The only exception applies to equipment models (like <code>Fluid.Actuators.Dampers.Exponential</code>)
that already provide a feedback signal as an output (for example <code>y_actual</code> for actuator and mover models).
However, if <code>use_inputFilter=false</code> then <code>y_actual</code> is directly connected to the input signal <code>y</code>, potentially creating an algebraic loop if the control logic uses the equipment status.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Open Issue</div><div class="admonitionContent_S0QG"><p>Switching to using <code>StatusEmulator</code> instead of <code>y_actual</code> if <code>use_inputFilter=false</code> is being implemented through <a href="https://github.com/lbl-srg/modelica-buildings/issues/3499" target="_blank" rel="noopener noreferrer">#3499</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="parameter-record">Parameter Record<a href="#parameter-record" class="hash-link" aria-label="Direct link to Parameter Record" title="Direct link to Parameter Record">​</a></h2><p>All design and operating parameters are declared within a Modelica record class. This record is used to</p><ul><li>assign design and operating parameter values for all subcomponents,</li><li>support parameter propagation from a top-level, whole HVAC system parameter record,</li><li>populate the <a href="https://docs.google.com/document/d/16Z8HqTi3vNV3HUaa4ijBPVSQvA4MyGTu8bxoGTBD2YI/edit?usp=sharing" target="_blank" rel="noopener noreferrer">equipment schedule in the UI</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-rules">Implementation Rules<a href="#implementation-rules" class="hash-link" aria-label="Direct link to Implementation Rules" title="Direct link to Implementation Rules">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="subrecord-with-configuration-parameters">Subrecord with Configuration Parameters<a href="#subrecord-with-configuration-parameters" class="hash-link" aria-label="Direct link to Subrecord with Configuration Parameters" title="Direct link to Subrecord with Configuration Parameters">​</a></h4><p>Within the parameter record, all configuration parameters are (only) accessible via an instance of the configuration record <code>cfg</code>.
This instance uses the annotation <code>annotation (Dialog(enable=false))</code> as it should not be exposed to the user<!-- -->—<!-- -->and record classes do not allow for protected elements, and this instance cannot be <code>final</code> as it is overridden.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The final override is debatable and the bindings of record instances containing final parameter assignments appear to be under-specified.
As a result, the behavior varies across Modelica tools. And even for a given tool, it varies with the constructs being used (such as inheritance or direct definition).
Dymola sometimes (see SRF00860858) triggers a &quot;final overriding&quot; error when a record instance contains final bindings and the record itself is propagated from a higher composition level.
OCT never yields a warning.</p></div></div><p>When instantiated within the interface class, the parameter record uses a binding with the <a href="#configuration-record">local instance of the configuration record</a>, i.e., <code>dat(cfg=cfg)</code>.
Here again, because this binding will be overridden when propagated <code>dat</code> from a top-level whole-building record, the <code>final</code> keyword must not be used in this binding.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="parameter-propagation">Parameter Propagation<a href="#parameter-propagation" class="hash-link" aria-label="Direct link to Parameter Propagation" title="Direct link to Parameter Propagation">​</a></h4><p>Parameter propagation is implemented as follows.</p><ul><li>Configuration parameters are assigned <strong><em>from</em></strong> the component model <strong><em>to</em></strong> the record, and propagated <strong><em>up</em></strong> the instance tree.</li><li>Design and operating parameters are assigned <strong><em>from</em></strong> the record <strong><em>to</em></strong> the component model, and propagated <strong><em>down</em></strong> the instance tree.</li></ul><p>The record for the <a href="#control-section">controller section</a> needs to be instantiated (not extended) in the master record because it requires many configuration parameters (such as <code>typFanSup</code>) that have duplicates in the master record.</p><p>At the component level, we instantiate the parameter record as <code>dat</code> and bind (with <code>final</code>) local design and operating parameters to the record elements.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>This implementation is similar to the one from <code>Fluid.Chillers.ElectricEIR</code>.</p><p>However, other classes such as <code>Fluid.Actuators.BaseClasses.PartialTwoWayValve</code> extend the parameter class <code>Fluid.Actuators.BaseClasses.ValveParameters</code> to integrate the parameter definitions in a flat structure.</p></div></div></details><p>This allows simpler propagation (only the record is passed in) which is agnostic from the parameter structure of the constraining class (for example <code>mWat_flow_nominal</code> is not defined in <code>Templates.Components.Coils.Interfaces.PartialCoil</code>).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-only-one-nesting-level">Use Only One Nesting Level<a href="#use-only-one-nesting-level" class="hash-link" aria-label="Direct link to Use Only One Nesting Level" title="Direct link to Use Only One Nesting Level">​</a></h4><p>If needed, component records must extend (not instantiate) subcomponent records.
For example in <code>Templates.Components.Coils.Interfaces.Data</code>:</p><ul><li>the class cannot extend <code>Templates.Components.Valves.Interfaces.Data</code> because of the colliding declarations of <code>typ</code>,</li><li>so <code>dpValve_nominal</code> is declared locally and a protected record with the type <code>Templates.Components.Valves.Interfaces.Data</code> is constructed to pass in parameters to the valve component.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exposed-parameters">Exposed Parameters<a href="#exposed-parameters" class="hash-link" aria-label="Direct link to Exposed Parameters" title="Direct link to Exposed Parameters">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="design-and-operating-parameters">Design and Operating Parameters<a href="#design-and-operating-parameters" class="hash-link" aria-label="Direct link to Design and Operating Parameters" title="Direct link to Design and Operating Parameters">​</a></h4><p>In addition to the configuration parameters, the record contains all design and operating parameters required</p><ol><li>by the sequence of operation for all possible system configurations, see <a href="/modelica-buildings-templates/more/references#Ashrae21">ASHRAE (2021)</a> Section 3,</li><li>for sizing equipment models (most of these parameters are already included in 1.).</li></ol><p>Modeling and parameters from the &quot;Advanced&quot; dialog tab <strong><em>shall not be included</em></strong> in this record.
The record should be viewed as a digital avatar of the manufacturer’s data sheet for a given system, and as such, should only contain equipment and control parameters that HVAC designers are familiar with.</p><p>The set of required parameters depends on the actual system configuration.
However, MLS does not allow parameters to be conditionally instantiated. (More precisely, conditional components can only be used in connect statements, which prevents the use of conditional parameters.)
As a workaround, we use parameter declarations with</p><ul><li>an <code>enable</code> annotation, and</li><li>an explicit <code>start</code> attribute.</li></ul><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>From the language specification:</p><blockquote><p>If <code>enable = false</code>, the input field may be disabled and no input can be given.</p></blockquote><p>In our case, if the <code>enable</code> attribute evaluates to false, these parameters are actually not used in the flat equation system — after removing the conditional components with false condition and taking into account all redeclarations. We use the start attribute to provide a &quot;placeholder&quot; value that has no impact whatsoever on the simulation results.</p><p>For more details, refer to Section 6.2 and Listing 2 of <a href="/modelica-buildings-templates/more/references#Gautier23">Gautier (2023)</a>.</p></div></div></details><h4 class="anchor anchorWithStickyNavbar_LWe7" id="system-tags">System Tags<a href="#system-tags" class="hash-link" aria-label="Direct link to System Tags" title="Direct link to System Tags">​</a></h4><p>System tags are optional parameters that are not used for simulation but nevertheless included in the parameter record of each template to support future workflow automation (e.g., parameterization of a template by means of an external <a href="https://docs.google.com/document/d/16Z8HqTi3vNV3HUaa4ijBPVSQvA4MyGTu8bxoGTBD2YI/edit?usp=sharing" target="_blank" rel="noopener noreferrer">equipment schedule</a>).</p><pre class="shiki light-plus with-title" style="background-color:#FFFFFF;color:#000000" title="Templates/AirHandlersFans/Data/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Data/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">String</span><span style="color:#000000"> id=</span><span style="color:#A31515">&quot;&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#A31515">&quot;System tag&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#008000">annotation (Dialog(tab=&quot;Advanced&quot;));</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">String</span><span style="color:#000000"> id_souChiWat=</span><span style="color:#A31515">&quot;&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#A31515">&quot;CHW supply system tag&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#008000">annotation (Dialog(tab=&quot;Advanced&quot;, enable=have_souChiWat));</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">String</span><span style="color:#000000"> id_souHeaWat=</span><span style="color:#A31515">&quot;&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#A31515">&quot;HHW supply system tag&quot;</span></div><div class="line"><span style="color:#000000">    </span><span style="color:#008000">annotation (Dialog(tab=&quot;Advanced&quot;, enable=have_souHeaWat));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus with-title" style="background-color:#1E1E1E;color:#D4D4D4" title="Templates/AirHandlersFans/Data/PartialAirHandler.mo"><div class="code-title">Templates/AirHandlersFans/Data/PartialAirHandler.mo</div><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">String</span><span style="color:#D4D4D4"> id=</span><span style="color:#CE9178">&quot;&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#CE9178">&quot;System tag&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#6A9955">annotation (Dialog(tab=&quot;Advanced&quot;));</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">String</span><span style="color:#D4D4D4"> id_souChiWat=</span><span style="color:#CE9178">&quot;&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#CE9178">&quot;CHW supply system tag&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#6A9955">annotation (Dialog(tab=&quot;Advanced&quot;, enable=have_souChiWat));</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">String</span><span style="color:#D4D4D4"> id_souHeaWat=</span><span style="color:#CE9178">&quot;&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#CE9178">&quot;HHW supply system tag&quot;</span></div><div class="line"><span style="color:#D4D4D4">    </span><span style="color:#6A9955">annotation (Dialog(tab=&quot;Advanced&quot;, enable=have_souHeaWat));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-schematic">System Schematic<a href="#system-schematic" class="hash-link" aria-label="Direct link to System Schematic" title="Direct link to System Schematic">​</a></h2><p>Refer to the <a href="https://lbl-srg.github.io/ctrl-flow/requirements.html#engineering-schematic" target="_blank" rel="noopener noreferrer">specification for the generation of engineering schematics</a> if needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h3><p>Below is an illustration of the kind of schematic (or control diagram) we want to generate, taken from <a href="https://github.com/lbl-srg/modelica-buildings/blob/4efb7ed6e0f307f339714a6b238e52922f193234/Buildings/Templates/HeatingPlants/HotWater/Validation/BoilerPlant.mo" target="_blank" rel="noopener noreferrer"><code>Templates.HeatingPlants.HotWater.Validation.BoilerPlant</code></a> in branch <code>issue3266_template_HW_plant</code>, using Dymola&#x27;s feature &quot;Show Component&quot;.</p><p><img loading="lazy" alt="schmatic" src="/modelica-buildings-templates/assets/images/HWPlant-31373e82ee60e32d2c0669373c08cde5.png" width="1922" height="1158" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="component-icons">Component Icons<a href="#component-icons" class="hash-link" aria-label="Direct link to Component Icons" title="Direct link to Component Icons">​</a></h3><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Modelica tool support</div><div class="admonitionContent_S0QG"><p>Currently the SVG graphics integrated using class annotations such as <code>Icon(graphics={Bitmap(fileName=&lt;svg-file-path&gt;, visible=&lt;boolean-expression&gt;))</code> are</p><ul><li>not supported by Modelon Impact: ticket open at Modelon#2022042039000931 on the roadmap for the 2023.1 release,</li><li>not fully supported by OMEdit: most likely due to <code>&lt;boolean-expression&gt;</code> not being evaluated at UI runtime,</li><li>entirely supported by Dymola <code>&gt;=2022.x</code>.</li></ul></div></div><p>The master SVG document containing all raw icons provided by Taylor Engineering and used in <a href="/modelica-buildings-templates/more/references#Ashrae21">ASHRAE (2021)</a> is currently located at <a href="https://github.com/lbl-srg/modelica-buildings/blob/90c974a19eac3333c1da139961c5c504797b9259/Buildings/Resources/Images/Templates/Icons.svg" target="_blank" rel="noopener noreferrer"><code>Resources/Images/Templates/Icons.svg</code></a>.</p><p>Those raw icons must be processed as described below for Inkscape <code>&gt;=1.1</code> before being used in the icon layers of Modelica classes.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p>The requirements below stem from the following observations.</p><ul><li>The <a href="https://specification.modelica.org/maint/3.5/annotations.html#common-definitions" target="_blank" rel="noopener noreferrer">Modelica Language Specification</a> specifies <code>type DrawingUnit = Real(final unit=&quot;mm&quot;)</code>.</li><li>The default icon layer size in Dymola is <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo>×</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">200 \times 200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">200</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span> <!-- -->mm (<code>{{-100,-100},{100,100}}</code>). This corresponds to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo>×</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">10 \times 10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10</span></span></span></span></span> <!-- -->cells in the icon view. So one cell corresponds to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mo>×</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">20 \times 20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">20</span></span></span></span></span> <!-- -->mm.</li><li>When instantiated, a component has its icon scaled by a factor <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>10</mn></mrow><annotation encoding="application/x-tex">1/10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1/10</span></span></span></span></span> in the diagram layer. For example, a <code>Line</code> object with <code>thickness=5</code> in the icon layer is rendered as a <code>Line</code> object with <code>thickness=0.5</code> in the diagram layer.</li><li>When <code>thickness &lt; 0.25</code>, the stroke width remains unchanged in Dymola: so <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.2</mn></mrow><annotation encoding="application/x-tex">0.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.2</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.1</mn></mrow><annotation encoding="application/x-tex">0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.1</span></span></span></span></span> yield the same stroke width.</li><li>It seems that Dymola handles Bitmap objects as squares, i.e., the objects are scaled by the minimum of the <code>x</code> and <code>y</code> dimensions. Having external SVG files with equal height and width makes it easier to position and scale the graphical objects.</li></ul></div></div></details><ul><li>Select object, copy to new file.</li><li>Change stroke color to black and stroke width to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span></span> <!-- -->mm.</li><li>Account for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn></mrow><annotation encoding="application/x-tex">20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">20</span></span></span></span></span> <!-- -->mm for each grid cell in Dymola icon layer.<ul><li>So the default icon layer size of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo>×</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">10 \times 10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10</span></span></span></span></span> <!-- -->cells in Dymola corresponds to a page size of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo>×</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">200 \times 200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">200</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span> <!-- -->mm in Inkscape.</li></ul></li><li>For most of the AHU components, lock width/height ratio and change height to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn></mrow><annotation encoding="application/x-tex">200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span> <!-- -->mm.<ul><li>For transducers, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn></mrow><annotation encoding="application/x-tex">200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span> <!-- -->mm is for the probe, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>80</mn></mrow><annotation encoding="application/x-tex">80</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">80</span></span></span></span></span> <!-- -->mm is for the sensor casing.</li></ul></li><li>For polygons, the different segments will typically not be connected together (gap at each corner), so select each segment with <code>Node</code> tool and use <code>Node</code> functionalities to<ul><li><code>Convert selected objects to path</code></li><li><code>Join selected nodes</code></li><li>For the last corner use <code>Path/Union</code></li></ul></li><li>Text should be in sans-serif with font size of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>120</mn></mrow><annotation encoding="application/x-tex">120</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">120</span></span></span></span></span>.<ul><li>If needed (typically in case of specific text orientation), select text object and transform to path with <code>Path/Object to Path</code>.</li></ul></li><li>Set the page size with the same height and width (typically <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>200</mn><mo>×</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">200 \times 200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">200</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">200</span></span></span></span></span> <!-- -->mm) and center icons in the page.</li><li>Save as Inkscape SVG.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphical-primitives">Graphical Primitives<a href="#graphical-primitives" class="hash-link" aria-label="Direct link to Graphical Primitives" title="Direct link to Graphical Primitives">​</a></h3><p>In addition to external SVG files, the schematics may use Modelica graphical primitives with the following conventions.</p><table><thead><tr><th>Equipment</th><th>Primitive</th><th>Icon layer</th><th>Diagram layer</th></tr></thead><tbody><tr><td>Supply pipe (*)</td><td>Line, solid</td><td>Thickness <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.5</span></span></span></span></span></td><td>Thickness <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">5</span></span></span></span></span></td></tr><tr><td>Return pipe (*)</td><td>Line, dashed</td><td>Thickness <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.5</span></span></span></span></span></td><td>Thickness <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">5</span></span></span></span></span></td></tr><tr><td>Duct wall</td><td>Line, solid</td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>)</td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>)</td></tr><tr><td>Capillary tube (pressure sensor)</td><td>Polygon or rectangle</td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>), width <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10</span></span></span></span></span></td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>), width <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span></span></td></tr><tr><td>Motor shaft (actuator), connection between sensor and transmitter</td><td>Line, solid</td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>)</td><td>Default thickness (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">0.25</span></span></span></span></span>)</td></tr></tbody></table><p><em>(<!-- -->*<!-- -->) This should be specified as a graphical annotation to the corresponding connect statement.</em></p><p>Graphical primitives that need to be pruned to generate the system schematic shall use the annotation <code>visible=viewDiagramAll</code> where <code>viewDiagramAll</code> is declared in the template interface class with:</p><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000"><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#0000FF">inner</span><span style="color:#000000"> </span><span style="color:#0000FF">parameter</span><span style="color:#000000"> </span><span style="color:#0000FF">Boolean</span><span style="color:#000000"> viewDiagramAll=</span><span style="color:#0000FF">false</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#A31515">&quot;Set to true to view all component icons in diagram view&quot;</span></div><div class="line"><span style="color:#000000">  </span><span style="color:#008000">annotation (Dialog(tab=&quot;Graphics&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4"><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#569CD6">inner</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">parameter</span><span style="color:#D4D4D4"> </span><span style="color:#569CD6">Boolean</span><span style="color:#D4D4D4"> viewDiagramAll=</span><span style="color:#569CD6">false</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#CE9178">&quot;Set to true to view all component icons in diagram view&quot;</span></div><div class="line"><span style="color:#D4D4D4">  </span><span style="color:#6A9955">annotation (Dialog(tab=&quot;Graphics&quot;));</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vendor-specific-annotations">Vendor Specific Annotations<a href="#vendor-specific-annotations" class="hash-link" aria-label="Direct link to Vendor Specific Annotations" title="Direct link to Vendor Specific Annotations">​</a></h2><p>Vendor annotations are either</p><ul><li>hierarchical annotations in the form of <code>&quot;__ctrlFlow&quot; class-modification</code>, using strict camel case formatting for any argument in the class modification, or</li><li>simple annotations in the form of <code>&quot;__ctrlFlow&quot; &quot;_&quot; IDENT</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-annotations">Class Annotations<a href="#class-annotations" class="hash-link" aria-label="Direct link to Class Annotations" title="Direct link to Class Annotations">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="__ctrlflow_template"><code>__ctrlFlow_template</code><a href="#__ctrlflow_template" class="hash-link" aria-label="Direct link to __ctrlflow_template" title="Direct link to __ctrlflow_template">​</a></h4><p>Ctrl-flow searches for this annotation and returns a list of files which are then treated as entry points to build the tree of system types. Both packages (corresponding to system types such as <code>Templates.AirHandlersFans</code>) and template classes (such as <code>Templates.AirHandlersFans.VAVMultiZone</code>) shall contain this annotation.</p><p>So the file arborescence:</p><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#000000">Templates</span></div><div class="line"><span style="color:#000000">├── AirHandlersFans</span></div><div class="line"><span style="color:#000000">│   ├── ...</span></div><div class="line"><span style="color:#000000">│   ├── package.mo  </span><span style="color:#008000"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#000000">│   └── VAVMultiZone.mo  </span><span style="color:#008000"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#000000">├── Components</span></div><div class="line"><span style="color:#000000">│   └── ...</span></div><div class="line"><span style="color:#000000">├── Data</span></div><div class="line"><span style="color:#000000">│   ├── AllSystems.mo</span></div><div class="line"><span style="color:#000000">│   ├── package.mo</span></div><div class="line"><span style="color:#000000">│   └── ...</span></div><div class="line"><span style="color:#000000">├── package.mo</span></div><div class="line"><span style="color:#000000">├── package.order</span></div><div class="line"><span style="color:#000000">├── Types.mo</span></div><div class="line"><span style="color:#000000">├── UsersGuide.mo</span></div><div class="line"><span style="color:#000000">└── ZoneEquipment</span></div><div class="line"><span style="color:#000000">    ├── ...</span></div><div class="line"><span style="color:#000000">    ├── package.mo  </span><span style="color:#008000"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#000000">    ├── VAVBoxCoolingOnly.mo  </span><span style="color:#008000"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#000000">    └── VAVBoxReheat.mo  </span><span style="color:#008000"># Contains __ctrlFlow_template annotation</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#D4D4D4">Templates</span></div><div class="line"><span style="color:#D4D4D4">├── AirHandlersFans</span></div><div class="line"><span style="color:#D4D4D4">│   ├── ...</span></div><div class="line"><span style="color:#D4D4D4">│   ├── package.mo  </span><span style="color:#6A9955"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#D4D4D4">│   └── VAVMultiZone.mo  </span><span style="color:#6A9955"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#D4D4D4">├── Components</span></div><div class="line"><span style="color:#D4D4D4">│   └── ...</span></div><div class="line"><span style="color:#D4D4D4">├── Data</span></div><div class="line"><span style="color:#D4D4D4">│   ├── AllSystems.mo</span></div><div class="line"><span style="color:#D4D4D4">│   ├── package.mo</span></div><div class="line"><span style="color:#D4D4D4">│   └── ...</span></div><div class="line"><span style="color:#D4D4D4">├── package.mo</span></div><div class="line"><span style="color:#D4D4D4">├── package.order</span></div><div class="line"><span style="color:#D4D4D4">├── Types.mo</span></div><div class="line"><span style="color:#D4D4D4">├── UsersGuide.mo</span></div><div class="line"><span style="color:#D4D4D4">└── ZoneEquipment</span></div><div class="line"><span style="color:#D4D4D4">    ├── ...</span></div><div class="line"><span style="color:#D4D4D4">    ├── package.mo  </span><span style="color:#6A9955"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#D4D4D4">    ├── VAVBoxCoolingOnly.mo  </span><span style="color:#6A9955"># Contains __ctrlFlow_template annotation</span></div><div class="line"><span style="color:#D4D4D4">    └── VAVBoxReheat.mo  </span><span style="color:#6A9955"># Contains __ctrlFlow_template annotation</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>yields the following UI objects:</p><p><img loading="lazy" alt="control" src="/modelica-buildings-templates/assets/images/list_systems_ui-f5a66335e3295c92e48c1e8880f87913.png" width="1506" height="715" class="img_ev3q"></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Alternative Approach Discussed With DEPT but Not Implemented</summary><div><div class="collapsibleContent_i85q"><blockquote><p>We should rather use a flag indicating that a package (in our case <code>Templates</code>) is to be considered as the &quot;root&quot; for all template URIs, for example: <code>__ctrlFlow(routing=&quot;root&quot;)</code>. And for each template class (for example <code>Templates.AirHandlersFans.VAVMultiZone</code>): <code>__ctrlFlow(routing=&quot;template&quot;)</code>. The contract for the template developer will then be that the class URI dictates the explorer tree structure, starting from the &quot;root&quot; package (necessarily unique inside a library). For example, the template <code>Templates.AirHandlersFans.VAVMultiZone</code> with the above annotation would yield the following tree structure.</p><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#000000">AirHandlersFans</span></div><div class="line"><span style="color:#000000">└── VAVMultiZone</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#D4D4D4">AirHandlersFans</span></div><div class="line"><span style="color:#D4D4D4">└── VAVMultiZone</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>Without having to add any annotation to the subpackage <code>Templates.AirHandlersFans</code>. So we would implicitly consider each folder between <code>routing=&quot;template&quot;</code> and <code>routing=&quot;root&quot;</code> to be a template category (like &quot;Air Handlers and Fans&quot;).</p></blockquote></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="declaration-annotations">Declaration Annotations<a href="#declaration-annotations" class="hash-link" aria-label="Direct link to Declaration Annotations" title="Direct link to Declaration Annotations">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="__ctrlflowenabletruefalse"><code>__ctrlFlow(enable=true|false)</code><a href="#__ctrlflowenabletruefalse" class="hash-link" aria-label="Direct link to __ctrlflowenabletruefalse" title="Direct link to __ctrlflowenabletruefalse">​</a></h4><p>Each declaration or <code>extends</code> statement may have a hierarchical annotation <code>&quot;__ctrlFlow&quot; &quot;(&quot; &quot;enable&quot; &quot;=&quot; logical-expression &quot;)&quot;</code> that allows disabling input fields in the ctrl-flow configuration dialog. This is similar to the Modelica annotation <code>Dialog(enable=true|false)</code> but provides additional flexibility and allows disabling all parameter input fields that are brought in by an <code>extends</code> statement.</p><p>It takes precedence over the standard annotation <code>Dialog(enable)</code>.</p><p>Typical use cases include classes from the Modelica Buildings Library that contain definitions of detailed simulation parameters and that are extended to define template components, or package classes used to specify the fluid properties.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Boolean Literal or Expression?</summary><div><div class="collapsibleContent_i85q"><p>Although only Boolean literals are used in the templates as of commit 675801b669, the expression evaluation engine is invoked when parsing <code>__ctrlFlow(enable...)</code>, see <a href="https://github.com/lbl-srg/ctrl-flow-dev/blob/e2bb34ca76e0d1ed7413691a89ffd8525e16c750/server/src/parser/parser.ts#L296-L317" target="_blank" rel="noopener noreferrer">https://github.com/lbl-srg/ctrl-flow-dev/blob/e2bb34ca76e0d1ed7413691a89ffd8525e16c750/server/src/parser/parser.ts#L296-L317</a>. So in practice, Boolean expressions could be used.</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-base">Code Base<a href="#code-base" class="hash-link" aria-label="Direct link to Code Base" title="Direct link to Code Base">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-workflow">Git Workflow<a href="#git-workflow" class="hash-link" aria-label="Direct link to Git Workflow" title="Direct link to Git Workflow">​</a></h3><p>Each new development should start by branching out from the master branch of the Modelica Buildings Library.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-tags">Code Tags<a href="#code-tags" class="hash-link" aria-label="Direct link to Code Tags" title="Direct link to Code Tags">​</a></h3><p>The development of templates usually requires several iterations with the author of the CDL implementation of the SOO.
This takes time. Code tags have proven useful in this context.</p><p>We adopt the code tags from <a href="https://peps.python.org/pep-0350/#mnemonics" target="_blank" rel="noopener noreferrer">PEP 350</a> to reference issues and feature enhancements directly in the Modelica code base.
All tags should include one of the tag names below in all caps, followed by the name, e-mail address, or other identifier of the person with the best context about the problem, and the GH issue number if available.
We keep it simple and only use:</p><ul><li><code>BUG</code> for what prevents from translating or simulating a model: <strong><em>should prevent merging</em></strong></li><li><code>FIXME</code> for any problematic code not suitable for production: <strong><em>should prevent merging</em></strong>, include <a href="https://peps.python.org/pep-0350/#mnemonics" target="_blank" rel="noopener noreferrer">PEP 350</a> <code>TODO</code> under that code tag</li><li><code>HACK</code> mainly for workarounds related to Modelica tools&#x27; limitations: reference the ticket number from the Modelica tool provider if available</li><li><code>RFE</code> for a clearly identified development need (as opposed to an idea)</li></ul><p>For example:</p><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000"><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#008000">// FIXME(AntoineGautier #1913): Should be conditional, depending on have_fanRel.</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4"><div class="language-id">mo</div><div class="code-container"><code><div class="line"><span style="color:#6A9955">// FIXME(AntoineGautier #1913): Should be conditional, depending on have_fanRel.</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><p>So we can collect all code tags with:</p><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#000000">grep -nER </span><span style="color:#A31515">&#x27;(^|/(\*|/)|&lt;!--|&quot;)\s*(BUG|FIXME|HACK|RFE)&#x27;</span><span style="color:#000000"> Templates/.</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4"><div class="language-id">sh</div><div class="code-container"><code><div class="line"><span style="color:#D4D4D4">grep -nER </span><span style="color:#CE9178">&#x27;(^|/(\*|/)|&lt;!--|&quot;)\s*(BUG|FIXME|HACK|RFE)&#x27;</span><span style="color:#D4D4D4"> Templates/.</span></div></code></div><button type="button" aria-label="Copy code to clipboard" class="copy-button">Copy</button></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-06-21T14:25:42.000Z">Jun 21, 2024</time></b> by <b>AntoineGautier</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--next" href="/modelica-buildings-templates/category/more"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">More</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#interface-class" class="table-of-contents__link toc-highlight">Interface Class: What Shall Be Declared?</a><ul><li><a href="#outside-connectors-needed-by-any-derived-class" class="table-of-contents__link toc-highlight">Outside Connectors Needed by Any Derived Class</a></li><li><a href="#both-the-parameter-record-and-locally-accessible-design-parameters" class="table-of-contents__link toc-highlight">Both the Parameter Record and Locally Accessible Design Parameters</a></li><li><a href="#configuration-record" class="table-of-contents__link toc-highlight">Both the Configuration Record and Locally Accessible Configuration Parameters</a></li><li><a href="#nested-expandable-connectors" class="table-of-contents__link toc-highlight">Nested Expandable Connectors</a></li></ul></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#replaceable-component" class="table-of-contents__link toc-highlight">Replaceable Component</a></li><li><a href="#non-replaceable-component" class="table-of-contents__link toc-highlight">Non-replaceable Component</a></li><li><a href="#section" class="table-of-contents__link toc-highlight">Section</a></li></ul></li><li><a href="#main-controller" class="table-of-contents__link toc-highlight">Main Controller</a><ul><li><a href="#control-section" class="table-of-contents__link toc-highlight">Control Section</a></li><li><a href="#control-parameters-and-binding-equations" class="table-of-contents__link toc-highlight">Control Parameters and Binding Equations</a></li><li><a href="#control-point-connections" class="table-of-contents__link toc-highlight">Control Point Connections</a></li><li><a href="#equipment-status" class="table-of-contents__link toc-highlight">Equipment Status</a></li></ul></li><li><a href="#parameter-record" class="table-of-contents__link toc-highlight">Parameter Record</a><ul><li><a href="#implementation-rules" class="table-of-contents__link toc-highlight">Implementation Rules</a></li><li><a href="#exposed-parameters" class="table-of-contents__link toc-highlight">Exposed Parameters</a></li></ul></li><li><a href="#system-schematic" class="table-of-contents__link toc-highlight">System Schematic</a><ul><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#component-icons" class="table-of-contents__link toc-highlight">Component Icons</a></li><li><a href="#graphical-primitives" class="table-of-contents__link toc-highlight">Graphical Primitives</a></li></ul></li><li><a href="#vendor-specific-annotations" class="table-of-contents__link toc-highlight">Vendor Specific Annotations</a><ul><li><a href="#class-annotations" class="table-of-contents__link toc-highlight">Class Annotations</a></li><li><a href="#declaration-annotations" class="table-of-contents__link toc-highlight">Declaration Annotations</a></li></ul></li><li><a href="#code-base" class="table-of-contents__link toc-highlight">Code Base</a><ul><li><a href="#git-workflow" class="table-of-contents__link toc-highlight">Git Workflow</a></li><li><a href="#code-tags" class="table-of-contents__link toc-highlight">Code Tags</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 The Regents of the University of California through Lawrence Berkeley National Laboratory. All rights reserved.</div></div></div></footer></div>
<script src="/modelica-buildings-templates/assets/js/runtime~main.f6823879.js"></script>
<script src="/modelica-buildings-templates/assets/js/main.85178fec.js"></script>
</body>
</html>